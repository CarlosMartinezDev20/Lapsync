<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Listado de Laptops</title>

    <!-- Fuente e iconos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />

    <!-- Estilos globales -->
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css" />

    <!-- Fijar tema antes de pintar -->
    <script>
        !function(){
          try{
            const t = localStorage.getItem('theme')
              || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', t);
            document.documentElement.style.colorScheme = t;
          }catch(e){}
        }();
    </script>

    <!-- Ajustes específicos de esta vista -->
    <style>
        /* Barra de búsqueda */
        .table-toolbar{
          padding:12px 16px;
          display:flex; align-items:center; justify-content:space-between; gap:12px;
          border-bottom:1px solid var(--border-soft);
        }
        .search{
          display:flex; align-items:center; gap:10px;
          background:var(--panel); border:1px solid var(--border-soft); border-radius:14px;
          padding:10px 12px; width:100%; max-width:520px; box-shadow:var(--shadow-1);
        }
        .search input{ border:0; outline:0; background:transparent; width:100%; color:var(--text); font:inherit }

        /* Pulido del header de la tabla */
        .data-table thead th{
          position:sticky; top:0; z-index:2;
          font-weight:800; letter-spacing:.2px;
          backdrop-filter:saturate(1.05) blur(4px);
          background:linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.62));
          border-bottom:1px solid var(--border-soft);
          padding:12px 14px;
        }
        html[data-theme="dark"] .data-table thead th{
          background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
        }
        .data-table thead th:first-child{ border-top-left-radius:16px }
        .data-table thead th:last-child { border-top-right-radius:16px; text-align:center } /* centrado header acciones */

        /* Columnas */
        .w-id{ width:56px; min-width:56px }
        .col-actions{ min-width:340px; width:1%; white-space:nowrap; text-align:center } /* centrado columna */
        .actions-cell{ text-align:center } /* centrado cuerpo */

        /* Acciones ordenadas */
        .action-group{
          display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:nowrap; /* centrado botones */
        }
        .btn-xs{ padding:8px 10px; border-radius:10px; font-size:13px; line-height:1 }
        .action-group .btn i{ font-size:16px }
        .action-group .btn span{ margin-left:6px; font-weight:700 }

        @media (max-width:1120px){
          .action-group{ display:grid; grid-auto-flow:column; grid-auto-columns:minmax(110px,auto); gap:8px; justify-content:center }
        }
        @media (max-width:760px){
          .action-group .btn span{ display:none }
          .btn-xs{ padding:8px }
          .action-group{ grid-template-columns:repeat(3, 40px); grid-auto-flow:row; justify-content:center }
        }

        /* Botón toggle tema compacto */
        .btn-icon{
          width:40px; height:40px; display:grid; place-items:center; padding:0; border-radius:12px;
        }
    </style>
</head>

<body>

<main class="container app-main">

    <!-- Barra superior -->
    <section class="panel-bar centered-block">
        <div class="panel-left">
            <a th:href="@{/administrador/dashboard}" class="btn btn-secondary btn-back">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
            <div class="title">
                <i class="bi bi-laptop"></i>
                <div>
                    <div style="font-weight:800">Listado de Laptops</div>
                    <p class="meta" th:text="${#lists.size(laptops)} + ' registro(s)'">0 registro(s)</p>
                </div>
            </div>
        </div>

        <div class="header-actions" style="display:flex; gap:10px; align-items:center">
            <!-- Toggle de tema -->
            <button type="button" id="themeToggle" class="btn btn-ghost btn-icon theme-toggle" title="Cambiar tema">
                <i class="bi bi-brightness-high sun"></i>
                <i class="bi bi-moon moon"></i>
            </button>
            <a th:href="@{/laptops/create}" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Nueva laptop
            </a>
        </div>
    </section>

    <!-- Tarjeta con tabla -->
    <section class="panel-card centered-block animate-in in" style="--d:.05s">
        <div class="table-toolbar">
            <div class="search">
                <i class="bi bi-search" style="color:var(--muted)"></i>
                <input type="text" placeholder="Buscar por asset tag, marca, modelo, estado..." />
            </div>
        </div>

        <div class="table-wrap">
            <table class="data-table">
                <thead>
                <tr>
                    <th class="w-id">ID</th>
                    <th>Asset Tag</th>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Estado</th>
                    <th class="col-actions">Acciones</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="laptop : ${laptops}"
                    th:with="
              statusLower = ${#strings.toLowerCase(laptop.status)},
              cls = ${
                (statusLower=='available' || statusLower=='disponible') ? 'success' :
                (statusLower=='loaned'    || statusLower=='prestada')  ? 'warn'    :
                (statusLower=='retired'   || statusLower=='retirada')  ? 'danger'  : 'primary'
              },
              label = ${
                (statusLower=='available' || statusLower=='disponible') ? 'Disponible' :
                (statusLower=='loaned'    || statusLower=='prestada')  ? 'Prestada'   :
                (statusLower=='retired'   || statusLower=='retirada')  ? 'Retirada'   : laptop.status
              }">
                    <td class="w-id" th:text="${laptop.id}">12</td>
                    <td th:text="${laptop.assetTag}">001</td>
                    <td th:text="${laptop.brand}">Dell</td>
                    <td th:text="${laptop.model}">Latitude 5400</td>
                    <td>
                        <span class="badge" th:classappend="' ' + ${cls}" th:text="${label}">Disponible</span>
                    </td>

                    <td class="actions-cell">
                        <div class="action-group">
                            <a class="btn btn-secondary btn-xs"
                               th:href="@{|/laptops/edit/${laptop.id}|}" title="Editar" aria-label="Editar">
                                <i class="bi bi-pencil-square"></i><span>Editar</span>
                            </a>

                            <form th:action="@{|/laptops/${laptop.id}/deactivate|}" method="post" style="display:inline">
                                <button type="submit" class="btn btn-danger btn-xs" title="Desactivar" aria-label="Desactivar">
                                    <i class="bi bi-slash-circle"></i><span>Desactivar</span>
                                </button>
                            </form>

                            <a class="btn btn-ghost btn-xs"
                               th:href="@{|/laptops/${laptop.id}/history|}" title="Historial" aria-label="Historial">
                                <i class="bi bi-journal-text"></i><span>Historial</span>
                            </a>
                        </div>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(laptops)}">
                    <td colspan="6" style="text-align:center; color:var(--muted); padding:28px 12px">
                        <i class="bi bi-inbox"></i><br/>No hay laptops registradas
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

</main>

<footer class="app-footer container">
    <span>© <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> LapSync</span>
    <span class="muted">Panel de administración</span>
</footer>

<!-- Script del toggle de tema -->
<script>
    (function(){
      const btn = document.getElementById('themeToggle');
      if(!btn) return;
      btn.addEventListener('click', function(){
        const root = document.documentElement;
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', next);
        root.style.colorScheme = next;
        try{ localStorage.setItem('theme', next); }catch(e){}
      });
    })();
</script>

</body>
</html>
